{% extends "layout.html" %}
{% block content %}
<div class="welcome-card">
   <div class="welcome-content">
      <h3 class="welcome-text">Добро пожаловать в библиотеку знаний Mighty BI{% if current_user.is_authenticated %}, {{ current_user.username}}{% endif %}!</h3>
      {% if current_user.is_authenticated %}
      <a href="{{ url_for('create_article') }}" class="create-article-btn-big">Добавить статью</a>
      {% else %}
      <div class="login-buttons-container">
         <a class="login-buttons-big" href="{{ url_for('login') }}">Войдите</a>
         <a class="login-buttons-big" href="{{ url_for('register') }}">Зарегистрируйтесь</a>
      </div>
      {% endif %}
   </div>
   <img src="{{ url_for('static', filename='img/welcome2.jpg') }}" class="welcome-image">
</div>
{% for article in articles %}
<div class="article-card">
   <div class="article-card-header">
      <h3 class="article-card-title"><a href="{{ url_for('article_detail', article_id=article.id) }}">{{ article.title }}</a></h3>
      {% if current_user.is_authenticated %}
      {% if current_user.id == article.author_id or current_user.role.name in ['Администратор', 'Редактор'] %}
      <div class="article-card-actions">
         <a href="{{ url_for('edit_article', article_id=article.id) }}" class="edit-article-btn">
         <i class="fas fa-pencil-alt"></i>
         </a>
         <form action="{{ url_for('delete_article', article_id=article.id) }}" method="post" style="display: inline;">
            <button type="submit" class="delete-article-btn" onclick="return confirm('Вы уверены?')">
            <i class="fas fa-trash"></i>
            </button>
         </form>
      </div>
      {% endif %}
      {% endif %}
   </div>
   <div class="article-author-date">
      <div class="article-author">{{ article.author.username }}</div>
      <div class="article-date">{{ article.date_posted.strftime('%Y-%m-%d') }}</div>
   </div>
   {% for category in categories %}
   {% if category.name == article.category.name %}
   <a href="{{ url_for('category', category_name=category.name) }}" class="category-name-card">{{ article.category.name }}</a>
   {% endif %}
   {% endfor %}
   <div class="article-card-content">
      <p>{{ article.trimmed_content | safe }}</p>
      {% if article.need_more_link %}
      <a class="login-buttons" href="{{ url_for('article_detail', article_id=article.id) }}">Читать далее <i class="fa-solid fa-arrow-right"></i></a>
      {% endif %}
   </div>
</div>
{% endfor %}
{% endblock %}